{% extends 'frontend/base.html' %}

{% block title %}ë¡œê·¸ì¸ | ë©˜í† -ë©˜í‹° ë§¤ì¹­ ì‹œìŠ¤í…œ{% endblock %}

{% block content %}
<div class="hero min-h-screen hero-gradient" x-data="authPage()">
    <div class="hero-content flex-col lg:flex-row-reverse">
        <!-- ì™¼ìª½: ì†Œê°œ í…ìŠ¤íŠ¸ -->
        <div class="text-center lg:text-left text-white lg:ml-12">
            <h1 class="text-5xl font-bold mb-4">ë©˜í† -ë©˜í‹° ë§¤ì¹­</h1>
            <p class="text-xl mb-6">ì „ë¬¸ê°€ì™€ í•™ìŠµìë¥¼ ì—°ê²°í•˜ëŠ” í”Œë«í¼</p>
            <ul class="text-lg space-y-2">
                <li>âœ¨ ì „ë¬¸ ë©˜í† ì™€ì˜ 1:1 ë§¤ì¹­</li>
                <li>ğŸš€ ê°œì¸ ë§ì¶¤í˜• í•™ìŠµ ê²½í—˜</li>
                <li>ğŸ’¡ ì‹¤ë¬´ ì¤‘ì‹¬ì˜ ë©˜í† ë§</li>
                <li>ğŸ¯ ëª©í‘œ ë‹¬ì„±ê¹Œì§€ ì²´ê³„ì  ê´€ë¦¬</li>
            </ul>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ë¡œê·¸ì¸/íšŒì›ê°€ì… í¼ -->
        <div class="card w-full max-w-md bg-base-100 shadow-2xl">
            <div class="card-body">
                <!-- íƒ­ í—¤ë” -->
                <div class="tabs tabs-boxed mb-6">
                    <button 
                        class="tab flex-1" 
                        :class="{'tab-active': activeTab === 'login'}"
                        @click="activeTab = 'login'"
                    >
                        ë¡œê·¸ì¸
                    </button>
                    <button 
                        class="tab flex-1" 
                        :class="{'tab-active': activeTab === 'signup'}"
                        @click="activeTab = 'signup'"
                    >
                        íšŒì›ê°€ì…
                    </button>
                </div>

                <!-- ë¡œê·¸ì¸ í¼ -->
                <form x-show="activeTab === 'login'" @submit.prevent="login()" class="space-y-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">ì´ë©”ì¼</span>
                        </label>
                        <input 
                            type="email" 
                            id="email"
                            placeholder="example@email.com" 
                            class="input input-bordered"
                            x-model="loginForm.email"
                            required
                        />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">ë¹„ë°€ë²ˆí˜¸</span>
                        </label>
                        <input 
                            type="password" 
                            id="password"
                            placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                            class="input input-bordered"
                            x-model="loginForm.password"
                            required
                        />
                    </div>
                    
                    <div class="form-control mt-6">
                        <button 
                            class="btn btn-primary" 
                            id="login"
                            type="submit"
                            :disabled="loading"
                        >
                            <span x-show="loading" class="loading loading-spinner loading-xs"></span>
                            <span x-text="loading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'"></span>
                        </button>
                    </div>
                </form>

                <!-- íšŒì›ê°€ì… í¼ -->
                <form x-show="activeTab === 'signup'" @submit.prevent="signup()" class="space-y-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">ì´ë©”ì¼</span>
                        </label>
                        <input 
                            type="email" 
                            id="email"
                            placeholder="example@email.com" 
                            class="input input-bordered"
                            x-model="signupForm.email"
                            required
                        />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">ì´ë¦„</span>
                        </label>
                        <input 
                            type="text" 
                            placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" 
                            class="input input-bordered"
                            x-model="signupForm.name"
                            required
                        />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">ë¹„ë°€ë²ˆí˜¸</span>
                        </label>
                        <input 
                            type="password" 
                            id="password"
                            placeholder="6ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”" 
                            class="input input-bordered"
                            x-model="signupForm.password"
                            minlength="6"
                            required
                        />
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">ì—­í•  ì„ íƒ</span>
                        </label>
                        <div class="join">
                            <input 
                                class="join-item btn" 
                                type="radio" 
                                id="role"
                                name="role" 
                                value="mentor"
                                x-model="signupForm.role"
                                aria-label="ë©˜í† "
                            />
                            <input 
                                class="join-item btn" 
                                type="radio" 
                                name="role" 
                                value="mentee"
                                x-model="signupForm.role"
                                aria-label="ë©˜í‹°"
                            />
                        </div>
                    </div>
                    
                    <div class="form-control mt-6">
                        <button 
                            class="btn btn-primary" 
                            id="signup"
                            type="submit"
                            :disabled="loading"
                        >
                            <span x-show="loading" class="loading loading-spinner loading-xs"></span>
                            <span x-text="loading ? 'ê°€ì… ì¤‘...' : 'íšŒì›ê°€ì…'"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function authPage() {
    return {
        activeTab: 'login',
        loading: false,
        loginForm: {
            email: '',
            password: ''
        },
        signupForm: {
            email: '',
            name: '',
            password: '',
            role: 'mentee'
        },
        
        async login() {
            this.loading = true;
            try {
                const response = await axios.post('/login', this.loginForm);
                
                // JWT í† í° ì €ì¥
                localStorage.setItem('jwt_token', response.data.token);
                axios.defaults.headers.common['Authorization'] = `Bearer ${response.data.token}`;
                
                showToast('ë¡œê·¸ì¸ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!', 'success');
                
                // ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                setTimeout(() => {
                    window.location.href = '/dashboard/';
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                showToast(
                    error.response?.data?.error || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 
                    'error'
                );
            } finally {
                this.loading = false;
            }
        },
        
        async signup() {
            this.loading = true;
            try {
                await axios.post('/signup', this.signupForm);
                
                showToast('íšŒì›ê°€ì…ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'success');
                
                // ë¡œê·¸ì¸ íƒ­ìœ¼ë¡œ ì „í™˜
                this.activeTab = 'login';
                this.loginForm.email = this.signupForm.email;
                
                // í¼ ì´ˆê¸°í™”
                this.signupForm = {
                    email: '',
                    name: '',
                    password: '',
                    role: 'mentee'
                };
                
            } catch (error) {
                console.error('Signup error:', error);
                showToast(
                    error.response?.data?.error || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 
                    'error'
                );
            } finally {
                this.loading = false;
            }
        }
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° í™•ì¸
document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('jwt_token');
    if (token) {
        // ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœë©´ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
        window.location.href = '/dashboard/';
    }
});
</script>
{% endblock %}
